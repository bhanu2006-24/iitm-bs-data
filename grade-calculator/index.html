<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenZ | Grade Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: #e5e5e5; }
        .glass { background: #111; border: 1px solid #222; }
        /* Custom Range Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; height: 6px; border-radius: 5px; background: #222; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #6366f1; cursor: pointer; margin-top: -6px; border: 2px solid #000; box-shadow: 0 0 10px rgba(99, 102, 241, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; cursor: pointer; background: #333; border-radius: 5px; }
        
        .score-box { background: #0f0f0f; border: 1px solid #222; border-radius: 8px; transition: 0.2s; }
        .score-box:focus-within { border-color: #6366f1; background: #151515; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 relative">

    <div id="app" class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
            <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">Grade Engine</h1>
                <p class="text-gray-400 text-sm mt-1">Real-time CGPA Predictor - Sep 2025 Term</p>
            </div>
            <div class="w-full md:w-auto">
                 <select v-model="selectedCourseId" @change="loadCourse" class="bg-[#1a1a1a] border border-gray-800 rounded-lg px-4 py-2 text-sm text-gray-300 outline-none w-full md:w-80 shadow-lg">
                    <optgroup label="Foundation">
                        <option v-for="c in courses.filter(x=>x.level==='Foundation')" :key="c.id" :value="c.id">{{ c.subject }}</option>
                    </optgroup>
                    <optgroup label="Diploma">
                        <option v-for="c in courses.filter(x=>x.level==='Diploma')" :key="c.id" :value="c.id">{{ c.subject }}</option>
                    </optgroup>
                    <optgroup label="Degree">
                        <option v-for="c in courses.filter(x=>x.level==='Degree')" :key="c.id" :value="c.id">{{ c.subject }}</option>
                    </optgroup>
                </select>
            </div>
        </header>

        <div v-if="currentCourse" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left: Inputs -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Dynamic Inputs Grid -->
                <div class="glass p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-indigo-500"></span>
                            Score Components
                        </h3>
                         <button @click="resetScores" class="text-xs text-gray-500 hover:text-white transition">Reset</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div v-for="inp in currentCourse.inputs" :key="inp.id" class="relative group">
                            
                            <div class="flex justify-between mb-2">
                                <label class="text-sm text-gray-400 font-medium group-hover:text-indigo-300 transition">{{ inp.label }}</label>
                                <span class="font-mono text-sm font-bold text-white">{{ scores[inp.id] }} <span class="text-gray-600 text-xs text-normal">/{{ inp.max }}</span></span>
                            </div>
                            
                            <!-- Slider + Input Combo -->
                            <div class="flex items-center gap-4">
                                <input type="range" v-model.number="scores[inp.id]" :min="0" :max="inp.max" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                                
                                <input type="number" v-model.number="scores[inp.id]" :min="0" :max="inp.max" class="w-20 bg-[#151515] border border-gray-700 rounded-md px-2 py-1 text-sm text-center focus:border-indigo-500 outline-none">
                            </div>

                            <!-- Weight Badge -->
                            <div v-if="inp.weight" class="absolute -top-1 -right-2 text-[10px] text-gray-600 font-mono opacity-0 group-hover:opacity-100 transition">
                                Weight: {{ Math.round(inp.weight * 100) }}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grading Formula Reference -->
                 <div class="glass p-6 rounded-2xl relative overflow-hidden group">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Applied Formula</h3>
                    <div class="bg-[#0a0a0a] p-3 rounded-lg border border-gray-800 font-mono text-xs text-gray-400 leading-relaxed overflow-x-auto whitespace-pre-wrap">
                        {{ currentCourse.formula }}
                    </div>
                 </div>

            </div>

            <!-- Right: Result -->
            <div class="lg:col-span-1">
                <div class="sticky top-6">
                    <div class="glass p-8 rounded-3xl flex flex-col items-center justify-center text-center shadow-2xl shadow-indigo-500/10 border-indigo-500/20 relative overflow-hidden">
                        
                        <!-- Background Glow -->
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-indigo-900/10 pointer-events-none"></div>

                        <div class="relative z-10">
                            <div class="w-40 h-40 rounded-full flex items-center justify-center text-7xl font-black mb-4 relative mx-auto transition-all duration-500" :class="gradeColor">
                                {{ finalGrade }}
                                <div class="absolute inset-0 rounded-full border-[6px] opacity-20 border-current animate-pulse"></div>
                                <div class="absolute inset-0 rounded-full border-[6px] opacity-60 border-t-current animate-spin" style="animation-duration: 3s;"></div>
                            </div>
                            
                            <div class="text-4xl font-bold text-white mb-1 transition-all">{{ formatNum(finalScore) }}<span class="text-lg text-gray-500">%</span></div>
                            <div class="text-xs text-gray-500 uppercase tracking-widest mb-8">Total Weighted Score</div>

                            <!-- Status -->
                            <div class="flex items-center justify-center gap-2 mb-6">
                                <span class="px-3 py-1 rounded-full text-xs font-bold border" :class="passStatus ? 'bg-green-500/10 border-green-500/30 text-green-400' : 'bg-red-500/10 border-red-500/30 text-red-400'">
                                    {{ passStatus ? 'PASSED' : 'FAILED' }}
                                </span>
                            </div>
                            
                            <!-- Mini Graph/Bars for Components -->
                             <div class="w-full space-y-2 mt-4 pt-4 border-t border-gray-800">
                                <div v-for="inp in currentCourse.inputs.filter(x => x.weight)" :key="inp.id" class="flex items-center gap-2 text-xs">
                                    <span class="w-16 text-right text-gray-500 truncate">{{ inp.id }}</span>
                                    <div class="flex-1 h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-indigo-500" :style="{ width: ((scores[inp.id]/inp.max)*100) + '%' }"></div>
                                    </div>
                                    <span class="w-8 text-right text-gray-400">{{ scores[inp.id] }}</span>
                                </div>
                             </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    courses: [],
                    selectedCourseId: null,
                    currentCourse: null,
                    scores: {} // Dynamic object { ID: value }
                }
            },
            computed: {
                // Calculate T using the formula string
                result() {
                    if(!this.currentCourse) return { total: 0, grade: 'U', pass: false };

                    // 1. Prepare Variables
                    const context = {};
                    this.currentCourse.inputs.forEach(i => {
                        context[i.id] = this.scores[i.id] || 0;
                    });
                    
                    // 2. Evaluate Formula
                    let T = 0;
                    try {
                        // Safe evaluation: create function with keys as args
                        const keys = Object.keys(context);
                        const values = Object.values(context);
                        // Using Function constructor to parse valid JS math expression
                        // We must interpret Math directly or destructure it? 
                        // Actually new Function runs in global scope usually, so Math is available.
                        // But local vars aren't. We pass them as args.
                        const calcFn = new Function(...keys, `return ${this.currentCourse.formula}`);
                        T = calcFn(...values);
                    } catch(e) {
                         console.error("Formula Error", e);
                         T = 0;
                    }

                    // 3. Round T
                    T = Math.min(100, Math.max(0, T)); // Cap at 100

                    // 4. Pass Logic (Simplified General Rule: T >= 40 AND F >= 40% of max F)
                    const finalExam = this.currentCourse.inputs.find(i => i.id === 'F');
                    let hasEndTermCheck = false;
                    if(finalExam) {
                         const fScore = context['F'] || 0;
                         // Check if F < 40/100 equivalent
                         // Use finalExam.max to normalize
                         const ratio = fScore / finalExam.max;
                         if(ratio < 0.4) hasEndTermCheck = true;
                    }
                    
                    let pass = T >= 40;
                    if(hasEndTermCheck) pass = false;

                    // 5. Grade
                    let grade = 'U';
                    // Note: SEP 2025 doc mostly says S, A, B, C, D, E, U.
                    if(!pass) grade = 'U';
                    else if(T >= 90) grade = 'S';
                    else if(T >= 80) grade = 'A';
                    else if(T >= 70) grade = 'B';
                    else if(T >= 60) grade = 'C';
                    else if(T >= 50) grade = 'D';
                    else if(T >= 40) grade = 'E';
                    
                    return { total: T, grade, pass };
                },
                finalScore() { return this.result.total; },
                finalGrade() { return this.result.grade; },
                passStatus() { return this.result.pass; },
                gradeColor() {
                    const g = this.finalGrade;
                    if(g === 'S') return 'text-yellow-400';
                    if(g === 'A') return 'text-emerald-400';
                    if(['B','C'].includes(g)) return 'text-blue-400';
                    if(g === 'D') return 'text-orange-400';
                    return 'text-red-500';
                }
            },
            mounted() {
                this.loadCourses();
            },
            methods: {
                async loadCourses() {
                    try {
                        const res = await fetch('./data.json');
                        this.courses = await res.json();
                        if(this.courses.length > 0) {
                            // Default to first foundation course
                            this.selectedCourseId = this.courses[0].id;
                            this.loadCourse();
                        }
                    } catch(e) { console.error(e); }
                },
                loadCourse() {
                    this.currentCourse = this.courses.find(c => c.id === this.selectedCourseId);
                    this.scores = {};
                    this.currentCourse.inputs.forEach(inp => {
                        // Smart defaults
                        if(inp.id.startsWith('Bonus')) this.scores[inp.id] = 0;
                        else if(inp.id === 'F' || inp.id.includes('Qz') || inp.id.includes('OP')) this.scores[inp.id] = Math.floor(inp.max * 0.7);
                        else this.scores[inp.id] = inp.max; // Full score for assignments default
                    });
                },
                resetScores() {
                     this.currentCourse.inputs.forEach(inp => {
                        this.scores[inp.id] = 0;
                    });
                },
                formatNum(n) { return (n || 0).toFixed(1); }
            }
        }).mount('#app');
    </script>
</body>
</html>
