<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenZ | Dojo - Modular OPPE</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CodeMirror (Core + Modes) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/shell/shell.min.js"></script>

    <!-- Custom Source -->
    <link rel="stylesheet" href="./src/style.css">
</head>
<body>

    <div id="app" class="split-grid" :class="{'split-grid-admin': isAdminMode}">
        
        <!-- Sidebar: Questions -->
        <div class="glass flex flex-col h-full border-r border-gray-800">
            <div class="p-5 border-b border-gray-800 bg-[#0d0d0d]">
                <div class="flex justify-between items-center mb-5">
                    <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent flex items-center gap-3">
                        <i class="fa-solid fa-code"></i> GenZ Dojo
                    </h1>
                    <button @click="toggleAdmin" class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-gray-800/50 hover:bg-gray-800 transition border border-gray-700" :class="{'text-indigo-400 border-indigo-500/50 bg-indigo-500/10': isAdminMode}">
                        {{ isAdminMode ? 'Admin Mode' : 'Practice' }}
                    </button>
                </div>
                
                <!-- Subject Selector -->
                <div>
                     <select v-model="selectedSubject" @change="loadSubject" class="input-base text-sm font-medium">
                        <option value="python">Python Programming</option>
                        <option value="java">Java Programming</option>
                        <option value="pdsa">PDSA (Algorithms)</option>
                        <option value="sql">DBMS (SQL)</option>
                        <option value="system_commands">System Commands</option>
                        <option value="mlp">ML Practice</option>
                        <option value="c_prog">Programming in C</option>
                        <option value="big_data">Big Data</option>
                        <option value="mlops">MLOPS</option>
                        <option value="tds">Tools in DS</option>
                    </select>
                </div>
            </div>
            
            <div class="p-3 bg-[#0a0a0a] flex gap-2 border-b border-gray-800">
                <div class="relative w-full">
                    <i class="fa-solid fa-search absolute left-3 top-2.5 text-gray-600 text-xs"></i>
                    <input v-model="searchQuery" type="text" placeholder="Search questions..." class="input-base pl-8 py-2 text-xs rounded-full">
                </div>
                <button v-if="isAdminMode" @click="addNewQuestion" class="w-8 h-8 flex-shrink-0 bg-indigo-600 hover:bg-indigo-500 rounded-full text-white flex items-center justify-center transition shadow-lg shadow-indigo-500/20" title="Add Question">
                    <i class="fa-solid fa-plus text-xs"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto scroll-smooth p-2 space-y-1">
                <div v-if="loading" class="text-center text-gray-500 text-xs mt-10 flex flex-col items-center gap-2">
                    <i class="fa-solid fa-circle-notch fa-spin"></i> Loading...
                </div>
                <div v-else v-for="q in filteredQuestions" :key="q.id" 
                     @click="loadQuestion(q)"
                     class="question-item p-3 rounded cursor-pointer group"
                     :class="currentQuestion?.id === q.id ? 'active' : ''">
                    <div class="flex justify-between items-start mb-1">
                        <h3 class="font-medium text-sm truncate pr-2" :class="currentQuestion?.id === q.id ? 'text-blue-400' : 'text-gray-400 group-hover:text-gray-200'">{{ q.title }}</h3>
                        <div class="w-2 h-2 rounded-full mt-1.5 shadow-[0_0_5px_currentColor]" :class="getStatusColor(q.status).replace('bg-', 'text-')"></div>
                    </div>
                    <div class="flex gap-2 opacity-60 group-hover:opacity-100 transition">
                         <span v-if="q.difficulty" class="text-[10px] px-1.5 py-0.5 rounded bg-gray-800 text-gray-500 border border-gray-700">{{ q.difficulty }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle: Problem Statement OR Editor Form -->
        <div v-if="!isAdminMode" class="flex flex-col h-full border-r border-gray-800 bg-[#0a0a0a] overflow-y-auto scroll-smooth relative">
            <div v-if="currentQuestion" class="p-8 max-w-3xl mx-auto w-full fade-in">
                <div class="flex justify-between items-start mb-6 border-b border-gray-800 pb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-3">{{ currentQuestion.title }}</h2>
                        <div class="flex gap-3">
                            <span class="px-2.5 py-1 bg-green-900/20 text-green-400 border border-green-500/20 rounded text-[10px] font-bold uppercase tracking-wider">{{ currentQuestion.difficulty }}</span>
                            <span class="px-2.5 py-1 bg-gray-800 text-gray-400 border border-gray-700 rounded text-[10px] font-bold uppercase tracking-wider">{{ selectedSubject }}</span>
                        </div>
                    </div>
                </div>

                <div class="prose-custom text-sm">
                    <p class="whitespace-pre-line">{{ currentQuestion.description }}</p>
                    
                     <div v-if="currentQuestion.testCases && currentQuestion.testCases.length" class="mt-8">
                        <h4 class="text-gray-500 font-bold mb-4 uppercase text-xs tracking-widest flex items-center gap-2">
                             <i class="fa-solid fa-flask"></i> Example Cases
                        </h4>
                        <div v-for="(ex, idx) in currentQuestion.testCases.slice(0,3)" :key="idx" class="bg-[#111] border border-gray-800 rounded-lg p-5 mb-4 font-mono text-sm relative overflow-hidden group">
                            <div class="absolute top-0 left-0 w-1 h-full bg-gray-800 group-hover:bg-indigo-500 transition"></div>
                            <div class="mb-3">
                                <span class="text-gray-500 text-xs uppercase block mb-1">Input</span> 
                                <span class="text-yellow-500/90">{{ ex.input }}</span>
                            </div>
                            <div>
                                <span class="text-gray-500 text-xs uppercase block mb-1">Output</span> 
                                <span class="text-emerald-500/90">{{ ex.output }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-else class="flex flex-col items-center justify-center h-full text-gray-600">
                <i class="fa-regular fa-folder-open text-4xl mb-4 opacity-20"></i>
                <p>Select a question to start coding.</p>
            </div>
        </div>

        <!-- ADMIN EDITOR MODE MIDDLE PANE -->
        <div v-else class="flex flex-col h-full bg-[#0a0a0a] border-r border-gray-800 overflow-y-auto p-8 fade-in">
            <div v-if="currentQuestion" class="max-w-4xl mx-auto w-full">
                <div class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
                    <h2 class="text-2xl font-bold text-white">Editing Logic</h2>
                     <button @click="deleteQuestion" class="px-4 py-2 text-red-500 hover:text-red-400 bg-red-500/10 rounded border border-red-500/20 text-xs font-bold transition">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                </div>
                
                <div class="space-y-8">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Title</label>
                            <input v-model="currentQuestion.title" class="input-base bg-[#111]">
                        </div>
                         <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Difficulty</label>
                             <select v-model="currentQuestion.difficulty" class="input-base bg-[#111]">
                                 <option>Easy</option>
                                 <option>Medium</option>
                                 <option>Hard</option>
                             </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Description</label>
                        <textarea v-model="currentQuestion.description" class="input-base h-40 font-mono text-sm bg-[#111] leading-relaxed"></textarea>
                    </div>

                    <div class="bg-[#111] p-6 rounded-xl border border-gray-800">
                        <label class="block text-xs font-bold text-indigo-400 uppercase tracking-wider mb-3">Starter Code</label>
                        <textarea v-model="currentQuestion.starterCode" class="input-base h-32 font-mono text-sm bg-[#0a0a0a] text-gray-400"></textarea>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-4">
                             <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider">Test Cases</label>
                             <button @click="addTestCase" class="text-indigo-400 text-xs font-bold bg-indigo-500/10 px-3 py-1 rounded hover:bg-indigo-500/20 transition">+ Add Case</button>
                        </div>
                        <div class="space-y-4">
                            <div v-for="(tc, idx) in currentQuestion.testCases" :key="idx" class="flex gap-4 items-start bg-[#111] p-4 rounded-xl border border-gray-800 relative group">
                                <div class="text-gray-600 text-xs font-bold pt-3 w-6">#{{ idx+1 }}</div>
                                <div class="flex-1 grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="text-[10px] text-gray-500 block mb-1">Input</span>
                                        <textarea v-model="tc.input" class="input-base h-20 text-xs font-mono bg-[#0a0a0a]"></textarea>
                                    </div>
                                    <div>
                                        <span class="text-[10px] text-gray-500 block mb-1">Output</span>
                                        <textarea v-model="tc.output" class="input-base h-20 text-xs font-mono bg-[#0a0a0a]"></textarea>
                                    </div>
                                </div>
                                <button @click="currentQuestion.testCases.splice(idx, 1)" class="absolute top-2 right-2 text-gray-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-xmark"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                
                 <!-- Floating Save Bar -->
                <div class="fixed bottom-6 right-6 z-50">
                    <button @click="saveQuestions" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-full font-bold shadow-2xl shadow-indigo-500/40 flex items-center gap-2 transform hover:scale-105 transition">
                        <i class="fa-solid fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
            <div v-else class="flex flex-col items-center justify-center h-full text-gray-600">
                <p>Select or create a question to edit</p>
            </div>
        </div>

        <!-- Right: Editor & Console -->
        <div v-if="!isAdminMode" class="flex flex-col h-full bg-[#0a0a0a] border-l border-gray-800">
            <!-- Toolbar -->
            <div class="flex justify-between items-center p-3 border-b border-gray-800 bg-[#111]">
                <div class="flex gap-2 text-xs text-gray-500 items-center">
                    <i class="fa-solid fa-file-code"></i>
                    <span class="font-mono">{{ getFileName() }}</span>
                </div>
                <div class="flex gap-3">
                    <select v-model="fontSize" class="bg-[#0a0a0a] text-gray-400 text-xs rounded border border-gray-700 px-2 py-1 outline-none hover:border-gray-500">
                        <option value="12px">12px</option>
                        <option value="14px">14px</option>
                        <option value="16px">16px</option>
                    </select>
                    <button @click="runCode" :disabled="isRunning" class="px-4 py-1.5 bg-green-600 hover:bg-green-500 text-white text-xs font-bold rounded flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-green-900/20">
                        <span v-if="!isRunning"><i class="fa-solid fa-play"></i> Run</span>
                        <span v-else><i class="fa-solid fa-circle-notch fa-spin"></i> Running</span>
                    </button>
                    <button @click="saveQuestions" class="w-8 h-8 flex items-center justify-center bg-gray-800 hover:bg-gray-700 text-white text-xs rounded transition" title="Save Progress">
                        <i class="fa-solid fa-save"></i>
                    </button>
                </div>
            </div>

            <!-- Editor -->
            <div class="flex-1 relative editor-container" :style="{ fontSize: fontSize }">
                <textarea id="code-editor"></textarea>
            </div>

            <!-- Console -->
            <div class="h-1/3 border-t border-gray-800 bg-[#0f0f0f] flex flex-col">
                <div class="px-4 py-2 bg-[#151515] border-b border-gray-800 text-[10px] font-bold text-gray-500 uppercase tracking-widest flex justify-between">
                    <span>Terminal</span>
                    <button @click="consoleOutput = []" class="hover:text-white transition">Clear</button>
                </div>
                <div class="flex-1 p-4 font-mono text-xs overflow-y-auto whitespace-pre-wrap leading-relaxed">
                    <div v-if="consoleOutput.length === 0" class="text-gray-700 italic select-none">
                        <i class="fa-solid fa-terminal mr-2"></i> Ready to execute...
                    </div>
                    <div v-else>
                         <div v-for="(line, idx) in consoleOutput" :key="idx" :class="line.type === 'error' ? 'text-red-400' : line.type === 'success' ? 'text-green-400' : 'text-gray-300'" class="mb-1 border-l-2 pl-2 border-transparent" :style="line.type === 'error' ? 'border-color: #f87171' : ''">
                            {{ line.text }}
                         </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Load App Logic -->
    <script src="./src/app.js"></script>
</body>
</html>
