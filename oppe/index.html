<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenZ | Dojo - OPPE Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/shell/shell.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: #e5e5e5; }
        .glass { background: #111; border-right: 1px solid #333; }
        .editor-container .CodeMirror { height: 100%; font-family: 'JetBrains Mono', monospace; font-size: 14px; background: #0a0a0a; }
        .split-grid { display: grid; grid-template-columns: 280px 1fr 1fr; height: 100vh; }
        .scroll-smooth::-webkit-scrollbar { width: 6px; }
        .scroll-smooth::-webkit-scrollbar-track { background: #111; }
        .scroll-smooth::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    </style>
</head>
<body class="overflow-hidden">

    <div id="app" class="split-grid">
        
        <!-- Sidebar: Questions -->
        <div class="glass flex flex-col h-full border-r border-gray-800">
            <div class="p-4 border-b border-gray-800">
                <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-indigo-500 bg-clip-text text-transparent flex items-center gap-2">
                    <span class="text-2xl">&lt;/&gt;</span> Dojo
                </h1>
                
                <!-- Subject Selector -->
                <div class="mt-4">
                     <select v-model="selectedSubject" @change="loadSubject" class="w-full bg-[#1a1a1a] border border-gray-800 rounded px-3 py-2 text-sm text-gray-300 outline-none">
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="pdsa">PDSA (Python)</option>
                        <option value="sql">DBMS (SQL)</option>
                        <option value="system_commands">System Commands</option>
                        <option value="mlp">ML Practice</option>
                    </select>
                </div>
            </div>
            
            <div class="p-3">
                <input v-model="searchQuery" type="text" placeholder="Search questions..." class="w-full bg-[#1a1a1a] border border-gray-800 rounded px-3 py-2 text-sm text-gray-300 focus:border-blue-500 outline-none">
            </div>

            <div class="flex-1 overflow-y-auto scroll-smooth p-2 space-y-1">
                <div v-if="loading" class="text-center text-gray-500 text-sm mt-4">Loading...</div>
                <div v-else v-for="q in filteredQuestions" :key="q.id" 
                     @click="loadQuestion(q)"
                     :class="['p-3 rounded cursor-pointer transition border border-transparent', currentQuestion?.id === q.id ? 'bg-blue-900/20 border-blue-500/50' : 'hover:bg-gray-900']">
                    <div class="flex justify-between items-start mb-1">
                        <h3 class="font-medium text-sm truncate pr-2" :class="currentQuestion?.id === q.id ? 'text-blue-400' : 'text-gray-300'">{{ q.title }}</h3>
                        <div class="w-2 h-2 rounded-full mt-1.5" :class="getStatusColor(q.status)"></div>
                    </div>
                    <div class="flex gap-2">
                         <span v-if="q.difficulty" class="text-[10px] px-1.5 py-0.5 rounded bg-gray-800 text-gray-400 border border-gray-700">{{ q.difficulty }}</span>
                         <span v-if="q.examType" class="text-[10px] px-1.5 py-0.5 rounded bg-gray-800 text-gray-400 border border-gray-700">{{ q.examType }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle: Problem Statement -->
        <div class="flex flex-col h-full border-r border-gray-800 bg-[#0a0a0a] overflow-y-auto scroll-smooth relative">
            <div v-if="currentQuestion" class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-2">{{ currentQuestion.title }}</h2>
                        <div class="flex gap-2">
                            <span class="px-2 py-1 bg-green-900/30 text-green-400 border border-green-500/30 rounded text-xs">{{ currentQuestion.difficulty }}</span>
                            <span class="px-2 py-1 bg-gray-800 text-gray-400 border border-gray-700 rounded text-xs uppercase">{{ selectedSubject }}</span>
                        </div>
                    </div>
                </div>

                <div class="prose prose-invert prose-sm max-w-none text-gray-300">
                    <p class="whitespace-pre-line leading-relaxed">{{ currentQuestion.description }}</p>
                    
                    <div v-if="currentQuestion.testCases || currentQuestion.examples">
                        <h4 class="text-gray-400 font-bold mt-6 mb-3 uppercase text-xs tracking-wider">Example Cases</h4>
                        <div v-for="(ex, idx) in (currentQuestion.testCases || currentQuestion.examples).slice(0,3)" :key="idx" class="bg-[#151515] border border-gray-800 rounded-lg p-4 mb-4 font-mono text-sm">
                            <div class="mb-2"><span class="text-gray-500">Input:</span> <span class="text-yellow-500">{{ ex.input }}</span></div>
                            <div><span class="text-gray-500">Output:</span> <span class="text-emerald-500">{{ ex.output }}</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-else class="flex items-center justify-center h-full text-gray-600">Select a question to start</div>
        </div>

        <!-- Right: Editor & Console -->
        <div class="flex flex-col h-full bg-[#0a0a0a]">
            <!-- Toolbar -->
            <div class="flex justify-between items-center p-2 border-b border-gray-800 bg-[#111]">
                <div class="flex gap-2 text-xs text-gray-500">
                    <span class="flex items-center gap-1">{{ getFileName() }}</span>
                </div>
                <div class="flex gap-2">
                    <select v-model="fontSize" class="bg-gray-800 text-gray-300 text-xs rounded border border-gray-700 px-2 py-1 outline-none">
                        <option value="12px">12px</option>
                        <option value="14px">14px</option>
                        <option value="16px">16px</option>
                    </select>
                    <button @click="runCode" :disabled="isRunning" class="px-4 py-1.5 bg-green-600 hover:bg-green-500 text-white text-xs font-bold rounded flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed">
                        <span v-if="!isRunning">▶ Run Code</span>
                        <span v-else>Running...</span>
                    </button>
                     <button @click="saveQuestions" class="px-4 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded transition" title="Save Progress Locally">Save</button>
                </div>
            </div>

            <!-- Editor -->
            <div class="flex-1 relative editor-container" :style="{ fontSize: fontSize }">
                <textarea id="code-editor"></textarea>
            </div>

            <!-- Console -->
            <div class="h-1/3 border-t border-gray-800 bg-[#0f0f0f] flex flex-col">
                <div class="px-4 py-2 bg-[#151515] border-b border-gray-800 text-xs font-bold text-gray-400 uppercase tracking-wider flex justify-between">
                    <span>Console Output</span>
                    <button @click="consoleOutput = []" class="hover:text-white">Clear</button>
                </div>
                <div class="flex-1 p-4 font-mono text-xs overflow-y-auto whitespace-pre-wrap">
                    <div v-if="consoleOutput.length === 0" class="text-gray-600 italic">Run code to see results...</div>
                    <div v-else>
                         <div v-for="(line, idx) in consoleOutput" :key="idx" :class="line.type === 'error' ? 'text-red-400' : 'text-gray-300'" class="mb-1">{{ line.text }}</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    selectedSubject: 'python',
                    questions: [],
                    searchQuery: '',
                    currentQuestion: null,
                    editor: null,
                    consoleOutput: [],
                    isRunning: false,
                    fontSize: '14px',
                    loading: false
                }
            },
            computed: {
                filteredQuestions() {
                    return this.questions.filter(q => q.title.toLowerCase().includes(this.searchQuery.toLowerCase()));
                }
            },
            mounted() {
                this.initEditor();
                this.loadSubject(); // Load initial
            },
            methods: {
                initEditor() {
                    this.editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
                        mode: 'python',
                        theme: 'dracula',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        indentUnit: 4,
                        tabSize: 4,
                        scrollbarStyle: "null"
                    });
                    this.editor.on('change', () => {
                         if(this.currentQuestion) this.currentQuestion.userCode = this.editor.getValue(); 
                    });
                },
                getFileName() {
                    const extMap = { 'python': 'py', 'pdsa': 'py', 'mlp': 'py', 'java': 'java', 'sql': 'sql', 'system_commands': 'sh' };
                    return `main.${extMap[this.selectedSubject] || 'txt'}`;
                },
                setEditorMode() {
                    const modeMap = { 
                        'python': 'python', 'pdsa': 'python', 'mlp': 'python',
                        'java': 'text/x-java', 'sql': 'text/x-sql', 'system_commands': 'shell'
                    };
                    this.editor.setOption('mode', modeMap[this.selectedSubject] || 'python');
                },
                async loadSubject() {
                    this.loading = true;
                    this.questions = [];
                    this.currentQuestion = null;
                    this.setEditorMode();
                    
                    try {
                        const res = await fetch(`./${this.selectedSubject}.json`);
                        if(res.ok) {
                            this.questions = await res.json();
                            if(this.questions.length > 0) this.loadQuestion(this.questions[0]);
                            else this.editor.setValue("# No questions found in this file.");
                        } else {
                            throw new Error("File not found");
                        }
                    } catch(e) {
                         console.error(e);
                         this.consoleOutput = [{type:'error', text:`Failed to load ${this.selectedSubject}.json. Make sure the file exists.`}];
                    } finally {
                        this.loading = false;
                    }
                },
                loadQuestion(q) {
                    this.currentQuestion = q;
                    const code = q.userCode || q.starterCode || '';
                    this.editor.setValue(code);
                },
                getStatusColor(status) {
                    if (status === 'passed') return 'bg-green-500';
                    if (status === 'failed') return 'bg-red-500';
                    return 'bg-gray-600';
                },
                async runCode() {
                    if (!this.currentQuestion) return;
                    this.isRunning = true;
                    this.consoleOutput = [{type: 'info', text: 'Running tests...'}];

                    const code = this.editor.getValue();
                    let lang = 'python';
                    let version = '3.10.0';

                    // Language Mapping for Piston
                    if(this.selectedSubject === 'java') { lang = 'java'; version = '15.0.2'; }
                    else if(this.selectedSubject === 'system_commands') { lang = 'bash'; version = '5.0.0'; }
                    else if(this.selectedSubject === 'sql') { lang = 'sqlite3'; version = '3.36.0'; }

                    try {
                        const response = await fetch('https://emkc.org/api/v2/piston/execute', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                language: lang,
                                version: version,
                                files: [{ content: code }]
                            })
                        });
                        const result = await response.json();
                        
                        if (result.run) {
                            const output = result.run.output;
                            const isError = result.run.code !== 0;
                            this.consoleOutput = output.split('\n').map(l => ({ type: isError ? 'error' : 'normal', text: l })).filter(l => l.text);
                            if(!isError) this.consoleOutput.push({type: 'success', text: '✔ Execution finished.'});
                        }
                    } catch (err) {
                        this.consoleOutput = [{type: 'error', text: 'Error connecting to Piston API.'}];
                    } finally {
                        this.isRunning = false;
                    }
                },
                async saveQuestions() {
                     try {
                        const h = await window.showSaveFilePicker({ suggestedName: `${this.selectedSubject}.json` });
                        const w = await h.createWritable();
                        await w.write(JSON.stringify(this.questions, null, 2));
                        await w.close();
                        alert("File saved!");
                    } catch (e) { alert("Could not save file."); }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
